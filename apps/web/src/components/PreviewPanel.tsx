"use client";

import type { GenerationResult } from "@/app/page";
import styles from "./PreviewPanel.module.css";

interface PreviewPanelProps {
  result: GenerationResult | null;
  isLoading: boolean;
}

export function PreviewPanel({ result, isLoading }: PreviewPanelProps) {
  if (isLoading) {
    return (
      <div className={styles.panel}>
        <div className={styles.loading}>
          <div className={styles.spinner} />
          <p>ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ç”Ÿæˆä¸­...</p>
          <p className={styles.loadingHint}>
            é¸æŠã—ãŸã‚¢ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã®å“²å­¦ã‚’é©ç”¨ã—ã¦ã„ã¾ã™
          </p>
        </div>
      </div>
    );
  }

  if (!result) {
    return (
      <div className={styles.panel}>
        <div className={styles.empty}>
          <div className={styles.emptyIcon}>ğŸ¨</div>
          <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’å…¥åŠ›ã—ã€</p>
          <p>ã‚¢ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        </div>
      </div>
    );
  }

  return (
    <div className={styles.panel}>
      <div className={styles.header}>
        <span className={styles.agentLabel}>
          Generated by <strong>{result.agentName}</strong>
        </span>
        <span
          className={`${styles.qaScore} ${result.qaScore >= 80 ? styles.good : result.qaScore >= 60 ? styles.warning : styles.bad}`}
        >
          QA Score: {result.qaScore}/100
        </span>
      </div>

      {result.qaIssues.length > 0 && (
        <div className={styles.issues}>
          <p className={styles.issuesTitle}>QA Issues:</p>
          <ul>
            {result.qaIssues.map((issue, i) => (
              <li key={i}>{issue}</li>
            ))}
          </ul>
        </div>
      )}

      <div className={styles.preview}>
        <iframe
          srcDoc={`<!DOCTYPE html>
<html>
<head>
  <style>${result.css}</style>
</head>
<body>
  ${result.html}
</body>
</html>`}
          title="Design Preview"
          className={styles.iframe}
        />
      </div>

      <div className={styles.actions}>
        <button className={styles.actionButton}>HTMLã‚’ã‚³ãƒ”ãƒ¼</button>
        <button className={styles.actionButton}>CSSã‚’ã‚³ãƒ”ãƒ¼</button>
        <button className={`${styles.actionButton} ${styles.primary}`}>
          ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
      </div>
    </div>
  );
}
